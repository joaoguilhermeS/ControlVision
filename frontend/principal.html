<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Supervisory System - Fruit Production Monitoring</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #cfcfcf;
        padding: 0;
        margin: 0;
    }
    .topnav {
        background-color: #333;
        overflow: hidden;
        color: white;
        padding: 10px 20px;
    }
    .topnav a {
        float: left;
        color: #f2f2f2;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        font-size: 16px;
    }
    .topnav .role {
        float: right;
        color: #f2f2f2;
        padding: 14px 16px;
    }
    .container {
        background-color: #fff;
        padding: 20px;
        margin: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
    }
    .section {
        flex: 1 1 33%;
        border-right: 2px solid #ccc;
        margin-right: 20px;
    }
    .last-section {
        border-right: none;
        margin-right: 0;
    }
    .alarms, .observations, .ranking, .total-produced {
        margin-bottom: 20px;
        padding: 10px;
        background-color: #f0f0f0;
        border-radius: 5px;
    }
    .observation {
        background-color: #f0f0f0;
        border: 1px solid #ddd;
        padding: 8px;
        margin-bottom: 5px;
        border-radius: 8px;
        color: black;
    }
    .alarm {
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 8px;
        font-weight: bold;
    }
    .alarm.red { background-color: red; color: white; }
    .alarm.yellow { background-color: yellow; color: black; }
    .alarm.green { background-color: green; color: white; }
    .alarm.default { background-color: grey; color: white; }
    .sensor-info {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    .sensor-icon {
        width: 50px;
        height: 50px;
        margin-right: 10px;
    }
    .ranking ol, .total-produced ul {
        list-style: none;
        padding: 0;
    }
    .ranking li, .total-produced li {
        background-color: #e1f5fe;
        margin-bottom: 10px;
        border-radius: 8px;
        padding: 10px 20px;
        display: flex;
        align-items: center;
    }
    .ranking li::before, .total-produced li::before {
        content: counter(item) ". ";
        counter-increment: item;
        font-weight: bold;
        color: #0d47a1;
        margin-right: 10px;
        font-size: 16px;
    }
    .ranking, .total-produced {
        counter-reset: item;
    }
    .camera-frame {
        width: 100%;
        height: 300px; /* Adjust height based on your needs */
        background-color: #000;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
    }
</style>
</head>
<body>

<div class="topnav">
    <a href="#home">Início</a>
    <a href="#settings">Configurações</a>
    <a href="#alarms">Alarmes</a>
    <a href="#report">Relatório</a>
    <a href="#maintenance">Manutenção</a>
    <div class="role">Anônimo</div>
</div>

<div class="container">
    <div class="section">
        <div class="alarms">
            <h2>Alarmes</h2>
            <div id="alarmsList"></div>
        </div>
        <div class="observations">
            <h2>Observações</h2>
            <div id="observationsList"></div>
        </div>
    </div>
    <div class="section">
        <div class="ranking">
            <h2>Ranking de Produtividade</h2>
            <ol id="productivityRanking"></ol>
        </div>
        <div class="total-produced">
            <h2>Total Produzido</h2>
            <ul id="totalProducedList"></ul>
        </div>
    </div>
    <div class="section last-section">
        <div class="camera-frame">
            <!-- Display camera image here -->
            <span>Camera feed not available</span>
        </div>
        <div class="sensor-info">
            <img src="assets/login/sensor_indutivo.png" alt="Sensor de Contagem" class="sensor-icon">
            <p>Status: Ligado</p>
        </div>
        <div class="sensor-info">
            <img src="assets/login/sensor_temperatura.png" alt="Temperatura ambiente" class="sensor-icon">
            <p>Temperatura: 33.13 °C</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fetch all alarms
        fetch('http://172.203.231.235:8080/get-all-alarmes')
        .then(response => response.json())
        .then(data => {
            const alarmsContainer = document.getElementById('alarmsList');
            if (data.alarmes && data.alarmes.length > 0) {
                data.alarmes.forEach(alarm => {
                    const alarmDiv = document.createElement('div');
                    let alarmClass = 'alarm';
                    switch(alarm[2]) {
                        case '1':
                            alarmClass += ' red';
                            break;
                        case '2':
                            alarmClass += ' yellow';
                            break;
                        case '3':
                            alarmClass += ' green';
                            break;
                        default:
                            alarmClass += ' default';
                            break;
                    }
                    alarmDiv.className = alarmClass;
                    alarmDiv.textContent = `${alarm[0]} - ${alarm[3]}`;
                    alarmsContainer.appendChild(alarmDiv);
                });
            } else {
                alarmsContainer.textContent = 'Nenhum alarme encontrado.';
            }
        })
        .catch(error => console.error('Error fetching alarms:', error));

        // Fetch all observations
        fetch('http://172.203.231.235:8080/get-all-observacoes')
        .then(response => response.json())
        .then(data => {
            const observationsContainer = document.getElementById('observationsList');
            if (data.observacoes && data.observacoes.length > 0) {
                data.observacoes.forEach(observation => {
                    const observationDiv = document.createElement('div');
                    observationDiv.className = 'observation';
                    observationDiv.textContent = `${observation[1]} - ${observation[2]}`;
                    observationsContainer.appendChild(observationDiv);
                });
            } else {
                observationsContainer.textContent = 'Nenhuma observação encontrada.';
            }
        })
        .catch(error => console.error('Error fetching observations:', error));

        // Fetch productivity rankings
        fetch('http://172.203.231.235:8080/get-todays-production-sum-per-user')
        .then(response => response.json())
        .then(data => {
            const ranking = document.getElementById('productivityRanking');
            const productionSums = data.production_sums;
            Object.keys(productionSums).sort((a, b) => productionSums[b] - productionSums[a]).forEach(user => {
                const li = document.createElement('li');
                li.textContent = `${user} - ${productionSums[user]} frutas`;
                ranking.appendChild(li);
            });
        })
        .catch(error => console.error('Error fetching productivity:', error));

        // Fetch total production sums per item
        fetch('http://172.203.231.235:8080/get-todays-production-sum-per-item')
        .then(response => response.json())
        .then(data => {
            const totalProducedList = document.getElementById('totalProducedList');
            const productionSums = data.production_sums;
            Object.keys(productionSums).forEach(item => {
                const li = document.createElement('li');
                li.textContent = `Item ${item}: ${productionSums[item]} unidades`;
                totalProducedList.appendChild(li);
            });
        })
        .catch(error => console.error('Error fetching total produced:', error));
    });
</script>
</body>
</html>
