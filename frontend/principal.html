<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Supervisory System - Fruit Production Monitoring</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #cfcfcf;
        padding: 0;
        margin: 0;
    }
    .topnav {
        background-color: #333;
        overflow: hidden;
        color: white;
        padding: 10px 20px;
    }
    .topnav a {
        float: left;
        color: #f2f2f2;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        font-size: 16px;
    }
    .topnav .role {
        float: right;
        color: #f2f2f2;
        padding: 14px 16px;
    }
    .container {
        background-color: #fff;
        padding: 20px;
        margin: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
    }
    .section {
        flex: 1 1 33%;
        border-right: 2px solid #ccc;
        margin-right: 20px;
    }
    .last-section {
        border-right: none;
        margin-right: 0;
    }
    .alarms, .observations, .ranking, .total-produced {
        margin-bottom: 20px;
        padding: 10px;
        background-color: #f0f0f0;
        border-radius: 5px;
    }
    .observation {
        background-color: #f0f0f0; /* Lighter shade */
        border: 1px solid #ddd; /* Lighter border */
        padding: 8px;
        margin-bottom: 5px;
        border-radius: 8px;
        color: black; /* Ensuring text is visible */
    }
    .alarm {
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 8px;
        font-weight: bold;
    }
    .alarm.red { background-color: red; color: white; }
    .alarm.yellow { background-color: yellow; color: black; }
    .alarm.green { background-color: green; color: white; }
    .alarm.default { background-color: grey; color: white; }
    .sensor-info {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    .sensor-icon {
        width: 30px;
        height: 30px;
        margin-right: 10px;
    }
    .ranking-item {
        background-color: #e8e8e8;
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 5px;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .ranking-number {
        font-size: 1.2em;
        font-weight: bold;
        color: #333;
    }
</style>
</head>
<body>

<div class="topnav">
    <a href="#home">Início</a>
    <a href="#settings">Configurações</a>
    <a href="#alarms">Alarmes</a>
    <a href="#report">Relatório</a>
    <a href="#maintenance">Manutenção</a>
    <div class="role">Anônimo</div>
</div>

<div class="container">
    <div class="section">
        <div class="alarms">
            <h2>Alarmes</h2>
            <div id="alarmsList"></div>
        </div>
        <div class="observations">
            <h2>Observações</h2>
            <div id="observationsList"></div>
        </div>
    </div>
    <div class="section">
        <div class="ranking">
            <h2>Ranking de Produtividade</h2>
            <ol id="productivityRanking">
                <!-- Fetched productivity rankings will be listed here -->
            </ol>
        </div>
        <div class="total-produced">
            <h2>Total Produzido</h2>
            <p>Uvas verdes: 22 Caixas</p>
            <p>Uvas roxas: 13 Caixas</p>
        </div>
    </div>
    <div class="section last-section">
        <img src="fakepath/camera_view.jpg" alt="Câmera X" style="width:100%; height: auto; margin-bottom: 20px;">
        <div class="sensor-info">
            <img src="fakepath/sensor_icon.jpg" alt="Sensor de Contagem" class="sensor-icon">
            <p>Ligado</p>
        </div>
        <div class="sensor-info">
            <img src="fakepath/temperature_icon.jpg" alt="Temperatura ambiente" class="sensor-icon">
            <p>33.13 °C</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('http://172.203.231.235:8080/get-all-alarmes')
        .then(response => response.json())
        .then(data => {
            const alarmsContainer = document.getElementById('alarmsList');
            if (data.alarmes && data.alarmes.length > 0) {
                data.alarmes.forEach(alarm => {
                    const alarmDiv = document.createElement('div');
                    let alarmClass = 'alarm';
                    switch(alarm[2]) {
                        case '1':
                            alarmClass += ' red';
                            break;
                        case '2':
                            alarmClass += ' yellow';
                            break;
                        case '3':
                            alarmClass += ' green';
                            break;
                        default:
                            alarmClass += ' default';
                            break;
                    }
                    alarmDiv.className = alarmClass;
                    alarmDiv.textContent = `${alarm[0]} - ${alarm[3]}`;
                    alarmsContainer.appendChild(alarmDiv);
                });
            } else {
                alarmsContainer.textContent = 'Nenhum alarme encontrado.';
            }
        })
        .catch(error => console.error('Error fetching alarms:', error));

        fetch('http://172.203.231.235:8080/get-all-observacoes')
        .then(response => response.json())
        .then(data => {
            const observationsContainer = document.getElementById('observationsList');
            if (data.observacoes && data.observacoes.length > 0) {
                data.observacoes.sort((a, b) => new Date(a[1]) - new Date(b[1]));
                data.observacoes.forEach(observation => {
                    const observationDiv = document.createElement('div');
                    observationDiv.className = 'observation';
                    observationDiv.textContent = `${observation[1]} - ${observation[2]}`;
                    observationsContainer.appendChild(observationDiv);
                });
            } else {
                observationsContainer.textContent = 'Nenhuma observação encontrada.';
            }
        })
        .catch(error => console.error('Error fetching observations:', error));

        // Fetch productivity data and update ranking
        fetch('http://172.203.231.235:8080/get-todays-production-sum-per-user')
        .then(response => response.json())
        .then(data => {
            const ranking = document.getElementById('productivityRanking');
            const productionSums = data.production_sums;
            Object.keys(productionSums).sort((a, b) => productionSums[b] - productionSums[a]).forEach(user => {
            Object.keys(productionSums).sort((a, b) => productionSums[b] - productionSums[a]).forEach((user, index) => {
                const rankingItem = document.createElement('div');
                rankingItem.className = 'ranking-item';
                const numberSpan = document.createElement('span');
                numberSpan.className = 'ranking-number';
                numberSpan.textContent = `${index + 1}.`;
                const userSpan = document.createElement('span');
                userSpan.textContent = `${user}`;
                const quantitySpan = document.createElement('span');
                quantitySpan.textContent = `${productionSums[user]} frutas`;
                rankingItem.appendChild(numberSpan);
                rankingItem.appendChild(userSpan);
                rankingItem.appendChild(quantitySpan);
                ranking.appendChild(rankingItem);
            });
        })
        .catch(error => console.error('Error fetching productivity:', error));
    });
</script>
</body>
</html>
